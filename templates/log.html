{{define "head"}}

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
<title>Logs</title>
<link rel="stylesheet" href="static/css/logs_style.css">

<style>
    .btn-sync__text .material-symbols-outlined {
        font-variation-settings:
        'FILL' 1,
        'wght' 600,
        'GRAD' -25,
        'opsz' 100;
        color: rgb(223, 246, 255);
        vertical-align: text-bottom;
        font-size: 24px;
    }

    .date-picker {
        padding: 0.5%;
        border: rgba(147, 214, 255, 0.3) solid 2px;
        border-radius: 5px;
        font-family: "Calibri", sans-serif, system-ui, -apple-system, BlinkMacSystemFont;
        color: rgb(6, 40, 61);
    }
</style>
{{end}}

{{define "navbar"}}
<div class="topnav-right">
    <button type="button" class="btn btn-sync me-3 btn-lg" onclick="loading()">
        <span class="btn-sync__text">
            Refresh 
            <span class="material-symbols-outlined">sync</span>
        </span>
    </button>
</div>
{{end}}

{{define "sidebar-top"}}
{{end}}

{{define "sidebar-bottom"}}
{{end}}

{{define "content"}}
<div class="container-fluid px-5">
    <div class="mb-3">
        <h1 class="title">App logs</h1>
        <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras ut nibh enim. Aenean leo nibh, lacinia a lobortis eget, placerat a ante. Aenean quis condimentum urna. In leo est, rutrum finibus tempus ac, tincidunt mattis sapien. Integer nunc eros, venenatis ac gravida eget, rhoncus ac lectus. Nulla facilisi. Donec venenatis malesuada tincidunt. Sed vehicula eros quis diam aliquam pellentesque. Etiam accumsan nibh non ullamcorper sollicitudin. Suspendisse dui nibh, suscipit eu nisi a, pretium vestibulum dui. Donec sed libero quis metus tempor condimentum eleifend ac felis. Curabitur at leo ut nunc luctus vehicula. Suspendisse dignissim leo ut leo imperdiet, consectetur sollicitudin lacus porta. Etiam sit amet elit ornare, pharetra metus vitae, varius dolor.
        </p>
        <div class="row justify-content-between">
            <div class="dropdown col-lg-auto">
                <button class="btn-one dropdown-toggle mb-3" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                    Filter by type
                </button>
                <ul class="dropdown-menu" style="background-color: rgb(22, 75, 97); font-family: 'Calibri', sans-serif, system-ui, -apple-system, BlinkMacSystemFont;">
                    <li><a class="dropdown-item" onclick="filterByType(4)">INFO level</a></li>
                    <li><a class="dropdown-item" onclick="filterByType(3)">&ensp;<span class="material-symbols-outlined" style="font-weight: 200; transform: translateY(4px);">subdirectory_arrow_right</span>WARNING level</a></li>
                    <li><a class="dropdown-item" onclick="filterByType(2)">&ensp;&ensp;<span class="material-symbols-outlined" style="font-weight: 200; transform: translateY(4px);">subdirectory_arrow_right</span>ERROR level</a></li>
                    <li><a class="dropdown-item" onclick="filterByType(1)">&ensp;&ensp;&ensp;<span class="material-symbols-outlined" style="font-weight: 200; transform: translateY(4px);">subdirectory_arrow_right</span>FATAL level</a></li>
                </ul>
            </div>
            <div class="col-lg-7">
                <label for="filterDateStart" >Start date</label>
                <input class="date-picker mb-2 me-2" id="filterDateStart" type="date" oninput="CheckDate()"></input>
                <label for="filterDateEnd">End date</label>
                <input class="date-picker mb-2 me-2" id="filterDateEnd" type="date" oninput="CheckDate()"></input>
                <button class="btn-one mb-3" type="button" onclick="filterByDate()">Filter by date</button>
            </div>
            <div class="col-lg-2">
                <button class="btn-two mb-3" type="button" onclick="show_logs()">Reload</button>
            </div>
        </div>
        
        <div id="logs" tabindex="-1"></div>
    </div>
</div>

{{end}}

{{define "scripts"}}
    <script src=" https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js "></script>

    <script src="static/js/console.js"></script>

    <script>
        // const url = window.location.href.split(location.pathname)[0] + "/api/refresh";
        const theButton = document.querySelector(".btn-sync");

        function refresh(){
            fetch(url).then(res => {
                return res.text()
            }).then(text => {
                theButton.classList.remove("btn-sync--loading");
                let type = "";
                if (text.startsWith("Error")) { type = "error" }
                else { type = "success" }
                Swal.fire({
                    title: "Finished refreshing tasks",
                    text: text,
                    icon: type
                })
            })
        }
        function loading(){
            refresh();
            theButton.classList.add("btn-sync--loading");
        }
    </script>
{{end}}